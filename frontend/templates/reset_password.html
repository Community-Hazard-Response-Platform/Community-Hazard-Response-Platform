<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reset Password</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="icon" href="/static/images/logo_light.png" type="image/png">
</head>
<body>

    <div class="card">
        <a href="/" class="back-arrow">‚Üê</a>

        <div class="avatar">
            <div class="avatar-circle"></div>
            <div class="avatar-body"></div>
        </div>

        <h2>Update credentials</h2>

        <form action="/reset-password" method="POST" class="form" id="reset-form">

            <input 
                type="email" 
                name="email" 
                placeholder="Email" 
                class="input-field"
                required
            >

            <input 
                type="password" 
                name="password" 
                id="password"
                placeholder="New Password" 
                class="input-field"
                required
            >

            <input 
                type="password" 
                name="confirm_password" 
                id="confirm_password"
                placeholder="Repeat New Password" 
                class="input-field"
                required
            >

            {% if error %}
            <div class="error-message">{{ error }}</div>
            {% endif %}

            {% if success %}
            <div class="success-message">{{ success }}</div>
            {% endif %}

            <!-- Password rules -->
            <ul class="requirements" id="requirements" style="display: none;">
                <li id="length">At least 8 characters</li>
                <li id="uppercase">At least 1 uppercase letter</li>
                <li id="lowercase">At least 1 lowercase letter</li>
                <li id="number">At least 1 number</li>
                <li id="match">Passwords match</li>
            </ul>

            <button type="submit" class="btn-primary">
                Accept
            </button>

        </form>

    </div>

<script>
    // dynamic comprobation
    const password = document.getElementById("password");
    const confirm = document.getElementById("confirm_password");
    const requirements = document.getElementById("requirements");

    const lengthReq = document.getElementById("length");
    const uppercaseReq = document.getElementById("uppercase");
    const lowercaseReq = document.getElementById("lowercase");
    const numberReq = document.getElementById("number");
    const matchReq = document.getElementById("match");

    function validatePassword() {
        const val = password.value;
        const conf = confirm.value;

        // to not show the list of rules 
        if (val.length === 0 && conf.length === 0) {
            requirements.style.display = "none";
            return;
        }

        // when start writing, show the rules
        requirements.style.display = "block";

        if (val.length >= 8) lengthReq.classList.add("valid");
        else lengthReq.classList.remove("valid");

        if (/[A-Z]/.test(val)) uppercaseReq.classList.add("valid");
        else uppercaseReq.classList.remove("valid");

        if (/[a-z]/.test(val)) lowercaseReq.classList.add("valid");
        else lowercaseReq.classList.remove("valid");

        if (/\d/.test(val)) numberReq.classList.add("valid");
        else numberReq.classList.remove("valid");

        if (val && conf && val === conf) matchReq.classList.add("valid");
        else matchReq.classList.remove("valid");
    }

    password.addEventListener("input", validatePassword);
    confirm.addEventListener("input", validatePassword);
</script>


</body>
</html>
